<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>draggable</title>
	<link rel="stylesheet" href="/css/winbox.css">
	<link rel="stylesheet" href="/css/quasar.min.css">
	<link rel="stylesheet" href="/css/fa.css">
	<link rel="stylesheet" href="/css/material-icons.css">
	<link rel="stylesheet" href="/css/xui.css">
	<script src="/js/jquery.js"></script>
	<script src="/js/vue3.js"></script>
	<script src="/js/sortable.js"></script> 
	<script src="/js/tailwind.min.js"></script>
	<script src="/js/common.js"></script>
</head>

<body style="overflow:hidden;" onload="initPage()">
<div id="app-main" style="width:100%;height:100vh;"></div>
	
<template> 

<div class="p-2">
	<ul class="sortable-list" :ref="el=>xx.listEl=el">
      <li v-for="item in xx.list" 
		class="item" 
		:class="{dragging: xx.dragging}"
		draggable="true" @dragstart="e=>xx.dragging=true" @dragend="e=>xx.dragging=false">
        <div class="details">
          {{item.name}}
        </div>
        <i class="uil uil-draggabledots"></i>
      </li> 
    </ul> 
</div>

<div class="p-2">
	<ul class="tree-main" :ref="el=>xx.treeEl=el">
		<tree-item :item="xx.treeData" :store="store"/>
	</ul>
</div>

<script>
	xx.treeData = {
		name:'test', children:[
			{name:'aaa', children:[{name:'aa1'},{name:'aa2'},{name:'aa3'},{name:'aa4'}]},
			{name:'bbb', children:[{name:'bb1'},{name:'bb2'},{name:'bb3'},{name:'bb4'}]},
			{name:'ccc', children:[{name:'cc1'},{name:'cc2',children:[{name:'dd1'},{name:'dd2'}]}]},
		]
	}

	xx.list = [
		{ name: "John1", id: 0 },
		{ name: "Joao2", id: 1 },
		{ name: "Jean3", id: 2 }
	] 
	$(xx.listEl).sortable({
		ghostClass:'bg-red-200',
		animation:200,
	});
	setTimeout(()=> {
		$('.tree-group').sortable({
			ghostClass:'bg-red-200',
			group: 'nested',
			animation: 150,
			fallbackOnBody: true,
			swapThreshold: 0.65
		});
		$('.tree-item').sortable({
			ghostClass:'bg-red-200',
			group: 'leaf',
			animation: 150,
			fallbackOnBody: true,
			swapThreshold: 0.65
		});
	}, 500)	
	xx.click = (item, e) => clog("click ", item, e)
	xx.treeClass = item => item.children ? 'tree-group': 'tree-item'
</script>
		
<style>
	.sortable-list {
	  width: 425px;
	  padding: 25px;
	  padding: 30px 25px 20px;
	  border-radius: 7px;
	  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
	  background: #fff;
	}
	.sortable-list .item {
	  list-style: none;
	  display: flex;
	  justify-content: space-between;
	  align-items: center;
	  margin-bottom: 11px;
	  padding: 10px 13px;
	  border-radius: 5px;
	  border: 1px solid #ccc;
	  cursor: move;
	  background: #fff;
	}

	.item{
	  transition: all 0.2s ease-out;
	}
	.item i {
	  color: #474747;
	  font-size: 1.13rem;
	}
	.item.dragging {
	  opacity: 1;
	  transform: scale(1.05); /* 드래그 중 아이템 확대 */
	} 
</style>

	</template>
	
	
	<script>
		function initPage() {
			const jsPath='/js', storePath='/js/stores';
			xui.loadModule({
				pinia:				jsPath+'/pinia.js',
				quasar:				jsPath+'/quasar.umd.js',
				'xui/config':		jsPath+'/xui-config.js',
				'xui/dnd':	jsPath+'/xui-dnd.js',
			}, () => {
				const cf=xui.require('config');
				const paths = {
					'store/global': 		storePath+'/store-global.js',
					'store/test': 			storePath+'/store-test.js',
				}
				// paths[subPageCode] = jsPath+'/'+subPageCode+'.js';
				cf.createMainApp(jsPath, storePath)
				if( cf.tailwindUse && window.tailwind ) tailwind.config={ plugins: [initPlugIn()] }
				
				const content=getEl('app-main');
				const components=xui.require('dnd');
				components['tree-item']=defTreeItem;
				xui.loadModule(paths, () => xui.store('global').loadRoutePage(content,getTemplateSource(),xui.store('test'),components) )
			})
		}
		const defTreeItem = `<def TreeItem>		
			<li v-if="item" :class="xx.treeClass(item)">
				<div :style="item.style" :class="item.class" @click="e=>xx.click(item, e)">
					{{ item.name }}
				</div>
				<ul v-if="item.children && item.children.length" :class="item.childClass">
					<tree-item 
						v-for="(node, index) in item.children" :key="index" :item="node" :store="store"
					></tree-item>
				</ul>
			</li>
		</def>`;
	</script>
</body>
</html>
